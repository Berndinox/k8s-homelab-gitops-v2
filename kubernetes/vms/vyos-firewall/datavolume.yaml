---
# CDI DataVolume — importiert VyOS rolling-release qcow2 von GitHub.
#
# VyOS Image-Optionen:
#   A) Rolling (kostenlos, nightly): vyos-nightly-build GitHub Releases
#      URL-Format: https://github.com/vyos/vyos-nightly-build/releases/download/<tag>/vyos-<ver>-cloud-init-10G-qemu.qcow2
#      → Beispiel-Tag prüfen: https://github.com/vyos/vyos-nightly-build/releases/latest
#      NACHTEIL: URL ändert sich täglich, kein fester "latest"-Redirect für qcow2
#
#   B) Selbst-hosted (empfohlen für GitOps): Image einmalig bauen/herunterladen,
#      in eigenes OCI-Registry oder HTTP-Server laden und URL hier eintragen.
#
#   C) VyOS 1.4 LTS Cloud-Image (kostenpflichtig für Subscriber):
#      https://support.vyos.io/downloads
#
# AKTUELL: Platzhalter-URL — vor dem ersten Sync durch echte URL ersetzen!
# Empfohlenes Vorgehen: Image manuell in Longhorn/PVC laden via CDI upload:
#   virtctl image-upload dv vyos-boot --size=10Gi --image-path=./vyos.qcow2 -n vms
#
apiVersion: cdi.kubevirt.io/v1beta1
kind: DataVolume
metadata:
  name: vyos-boot-01
  namespace: vms
  annotations:
    # Nicht auto-löschen wenn VM gelöscht wird (Daten erhalten)
    cdi.kubevirt.io/storage.deleteAfterCompletion: "false"
spec:
  source:
    # Option A: HTTP-Import (URL anpassen!)
    # Beispiel mit einer konkreten nightly-build Version:
    http:
      url: "PLACEHOLDER — VyOS qcow2 URL hier eintragen"
      # Beispiel nightly:
      # url: "https://github.com/vyos/vyos-nightly-build/releases/download/1.5-rolling-202501010000/vyos-1.5-rolling-202501010000-cloud-init-10G-qemu.qcow2"
      #
      # Option B: Von lokalem HTTP-Server (z.B. wenn Image im Cluster hosted):
      # url: "http://image-server.vms.svc.cluster.local/vyos-latest.qcow2"
      #
      # Option C: Blank-Disk (manuelles Install via ISO):
      # Dann source durch ersetzen:
      #   blank: {}
  pvc:
    accessModes:
      - ReadWriteOnce
    resources:
      requests:
        storage: 10Gi
    storageClassName: longhorn
