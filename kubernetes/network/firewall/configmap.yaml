---
apiVersion: v1
kind: ConfigMap
metadata:
  name: firewall-config
  namespace: network
data:
  # Router config (native format) â€” delta-applied by watcher on change
  # Keep the config-version footer! It prevents migration errors.
  # Interface-Mapping (Kata + macvtap trunk):
  #   eth0     = K8s Pod Network (Cilium, nicht anfassen)
  #   eth1     = macvtap trunk on bond0 (alle VLANs 802.1Q tagged)
  #   eth1.5   = VLAN 5   WAN (DHCP vom ISP-Modem)
  #   eth1.10  = VLAN 10  DMZ
  #   eth1.30  = VLAN 30  WiFi Guest
  #   eth1.40  = VLAN 40  Client
  #   eth1.50  = VLAN 50  Server
  #   eth1.60  = VLAN 60  WiFi Secure
  #   eth1.100 = VLAN 100 Cluster
  #   eth1.200 = VLAN 200 MGMT
  router.conf: |
    interfaces {
        ethernet eth1 {
            description "Trunk (bond0 via macvtap)"
            vif 5 {
                address dhcp
                description "WAN (VLAN 5)"
            }
            vif 10 {
                address 10.0.10.199/24
                description "DMZ (VLAN 10)"
            }
            vif 30 {
                address 10.0.30.199/24
                description "WiFi Guest (VLAN 30)"
            }
            vif 40 {
                address 10.0.40.199/24
                description "Client (VLAN 40)"
            }
            vif 50 {
                address 10.0.50.199/24
                description "Server (VLAN 50)"
            }
            vif 60 {
                address 10.0.60.199/24
                description "WiFi Secure (VLAN 60)"
            }
            vif 100 {
                address 10.0.100.199/24
                description "Cluster (VLAN 100)"
            }
            vif 200 {
                address 10.0.200.199/24
                description "MGMT (VLAN 200)"
            }
        }
        loopback lo {
        }
    }
    nat {
        source {
            rule 100 {
                outbound-interface name eth1.5
                source {
                    address 10.0.0.0/8
                }
                translation {
                    address masquerade
                }
            }
        }
    }
    system {
        host-name homelab-gw
        config-management {
            commit-revisions 100
        }
        login {
            user vyos {
                authentication {
                    encrypted-password "__VYOS_PASSWORD_HASH__"
                }
            }
        }
        name-server 1.1.1.1
        name-server 8.8.8.8
        syslog {
            global {
                facility all {
                    level info
                }
            }
        }
    }

    protocols {
        bgp {
            system-as 65000
            neighbor 10.0.100.11 {
                remote-as 65100
                description "cilium-node-01"
                address-family {
                    ipv4-unicast {
                    }
                }
            }
            neighbor 10.0.100.12 {
                remote-as 65100
                description "cilium-node-02"
                address-family {
                    ipv4-unicast {
                    }
                }
            }
            neighbor 10.0.100.13 {
                remote-as 65100
                description "cilium-node-03"
                address-family {
                    ipv4-unicast {
                    }
                }
            }
            address-family {
                ipv4-unicast {
                    network 10.0.10.0/24 {
                    }
                    network 10.0.30.0/24 {
                    }
                    network 10.0.40.0/24 {
                    }
                    network 10.0.50.0/24 {
                    }
                    network 10.0.60.0/24 {
                    }
                    network 10.0.100.0/24 {
                    }
                    network 10.0.200.0/24 {
                    }
                }
            }
        }
    }

    // Warning: Do not remove the following line.
    // vyos-config-version: "bgp@6:broadcast-relay@1:cluster@2:config-management@1:conntrack@6:conntrack-sync@2:container@3:dhcp-relay@2:dhcp-server@11:dhcpv6-server@6:dns-dynamic@4:dns-forwarding@4:firewall@20:flow-accounting@3:https@7:ids@2:interfaces@34:ipoe-server@4:ipsec@14:isis@3:l2tp@9:lldp@3:mdns@1:monitoring@2:nat@8:nat66@3:nhrp@1:ntp@3:openconnect@3:openvpn@5:ospf@2:pim@1:policy@8:pppoe-server@12:pptp@5:qos@2:quagga@12:reverse-proxy@3:rip@1:rpki@2:salt@1:snmp@3:ssh@3:sstp@6:system@31:vpp@5:vrf@4:vrrp@4:vyos-accel-ppp@2:wanloadbalance@4:webproxy@2"
    // Release version: 2026.02
