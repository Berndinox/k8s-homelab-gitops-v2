---
apiVersion: v1
kind: ConfigMap
metadata:
  name: firewall-config
  namespace: network
data:
  # Router config (native format) — delta-applied by watcher on change
  # Keep the config-version footer! It prevents migration errors.
  # Interface-Mapping (Multus NADs → VyOS):
  #   eth0  = K8s Pod Network (Cilium, nicht anfassen)
  #   eth1  = VLAN 5   WAN (DHCP vom ISP-Modem)
  #   eth2  = VLAN 10  DMZ
  #   eth3  = VLAN 30  WiFi Guest
  #   eth4  = VLAN 40  Client
  #   eth5  = VLAN 50  Server
  #   eth6  = VLAN 60  WiFi Secure
  #   eth7  = VLAN 100 Cluster (ipvlan auf bond0.100)
  #   eth8  = VLAN 200 MGMT
  router.conf: |
    interfaces {
        ethernet eth1 {
            address dhcp
            description "WAN (VLAN 5)"
        }
        ethernet eth2 {
            address 10.0.10.199/24
            description "DMZ (VLAN 10)"
        }
        ethernet eth3 {
            address 10.0.30.199/24
            description "WiFi Guest (VLAN 30)"
        }
        ethernet eth4 {
            address 10.0.40.199/24
            description "Client (VLAN 40)"
        }
        ethernet eth5 {
            address 10.0.50.199/24
            description "Server (VLAN 50)"
        }
        ethernet eth6 {
            address 10.0.60.199/24
            description "WiFi Secure (VLAN 60)"
        }
        ethernet eth7 {
            address 10.0.100.199/24
            description "Cluster (VLAN 100)"
        }
        ethernet eth8 {
            address 10.0.200.199/24
            description "MGMT (VLAN 200)"
        }
        loopback lo {
        }
    }
    nat {
        source {
            rule 100 {
                outbound-interface name eth1
                source {
                    address 10.0.0.0/8
                }
                translation {
                    address masquerade
                }
            }
        }
    }
    system {
        host-name homelab-gw
        config-management {
            commit-revisions 100
        }
        login {
            user vyos {
                authentication {
                    encrypted-password "$6$QxPS.uk6mfo$9QBSo8u1FkH16gMyAVhus6fU3LOzvLR9Z9.82m3tiHFAxTtIkhaZSWssSgzt4v4dGAL8rhVQxTg0oAG9/q11h/"
                }
            }
        }
        name-server 1.1.1.1
        name-server 8.8.8.8
        syslog {
            global {
                facility all {
                    level info
                }
            }
        }
    }

    // Warning: Do not remove the following line.
    // vyos-config-version: "bgp@6:broadcast-relay@1:cluster@2:config-management@1:conntrack@6:conntrack-sync@2:container@3:dhcp-relay@2:dhcp-server@11:dhcpv6-server@6:dns-dynamic@4:dns-forwarding@4:firewall@20:flow-accounting@3:https@7:ids@2:interfaces@34:ipoe-server@4:ipsec@14:isis@3:l2tp@9:lldp@3:mdns@1:monitoring@2:nat@8:nat66@3:nhrp@1:ntp@3:openconnect@3:openvpn@5:ospf@2:pim@1:policy@8:pppoe-server@12:pptp@5:qos@2:quagga@12:reverse-proxy@3:rip@1:rpki@2:salt@1:snmp@3:ssh@3:sstp@6:system@31:vpp@5:vrf@4:vrrp@4:vyos-accel-ppp@2:wanloadbalance@4:webproxy@2"
    // Release version: 2026.02
